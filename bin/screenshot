#!/usr/bin/env sh

xrandr |
    grep -E '^.+ connected' |
    grep -Eo '[0-9]+x[0-9]+[0-9]+\+[0-9]+\+[0-9]+' |
    python -c "
import sys, time, PIL.ImageGrab

fn = f'''$HOME/Pictures/Screenshots/{time.strftime('%Y%m%d%H%M%S')}.png'''

try:
    from pyautogui import position
except ModuleNotFoundError:
    img = PIL.ImageGrab.grab()
    img.save(fn)
    raise SystemExit

l = []
for v in sys.stdin.read().strip().split('\n'):
    w, h = v.split('x')
    h, x, y = h.split('+')
    l.append(tuple(map(int, (w, h, x, y))))

a, b = position()
for (w, h, x, y) in l:
    p = w + x
    q = h + y
    if x <= a < p and y <= b < q:
        break

img = PIL.ImageGrab.grab((x, y, p, q))
img.save(fn)
"
